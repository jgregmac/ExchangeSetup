<#
There are documented bugs in the Exchange installer such that permissions are set incorrectly for the Malware filtering service.  See:
http://blogs.technet.com/b/ehlro/archive/2014/08/20/exchange-2013-malware-engine-updates-troubleshooting.aspx
and
https://social.technet.microsoft.com/Forums/en-US/09b9b26e-5898-42de-958d-ab967398bab8/error-id-6027-ms-filtering-engine-update-process-was-unsuccessful-in-contacting-the-primary-update?forum=exchangesvrgeneral
#>
<# Difficult approach... failing because set-acl is not running recursively...
$acls = @()
$acls += get-acl "D:\Exchange Server\V15\FIP-FS\data"
$acls += get-acl "D:\Exchange Server\V15\FIP-FS\data\Engines\amd64\Microsoft\bin"
$acls += get-acl "D:\Exchange Server\V15\FIP-FS\data\Engines\amd64\Microsoft\bin\manifest.cab"
$rule = New-Object System.Security.AccessControl.FileSystemAccessRule("NT AUTHORITY\NETWORK SERVICE","FullControl","ContainerInherit, ObjectInherit","None","Allow")
foreach ($acl in $acls) {
    $acl.SetAccessRule($rule)
    $acl.SetOwner([System.Security.Principal.NTAccount]'Administrators')
    set-acl -Path $pwd -AclObject $acl
}
#>

# make it easy:
cd "D:\Exchange Server\V15\FIP-FS"
& icacls .\Data "/grant" "NetworkService:(OI)(CI)(M)" /C /T

#optional:
#restart-Service -DisplayName 'microsoft filtering management service' -Force

Add-PSSnapin microsoft.forefront.filtering.management.powershell
Start-EngineUpdate
Get-EngineUpdateInformation